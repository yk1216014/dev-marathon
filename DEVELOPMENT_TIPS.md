# 機能追加および開発における重要ポイントまとめ

ここまでの開発（一覧・登録・詳細・更新・削除機能の実装）を通じて、特に注意すべき点を技術領域ごとにまとめました。今後の開発や保守の参考にしてください。

## 1. 環境構築・インフラ (Docker vs Local)
最もつまずきやすいポイントです。「手元のPCで動く」と「Dockerで動く」を両立させる工夫が必要です。

*   **データベース接続先の切り替え**:
    *   Docker内ではコンテナ名（例: `db`）で接続します。
    *   ローカル（Windows）からは `localhost` で接続します。
    *   **解決策**: `process.env.DB_HOST || 'localhost'` のように、環境変数を優先し、なければローカル値を採用するロジックを組むのが定石です。
*   **ポートの競合**:
    *   ローカルでサーバーを立ち上げているとき、Dockerでも同じポート（例: 5465）を使おうとすると競合します。「片方を止める」運用を徹底するか、ポート番号をずらす必要があります。
*   **Dockerの起動コマンド**:
    *   `compose.yml` で `command: npm start` を明示しないと、コンテナが立ち上がってもアプリが動いていない（待機状態）ことがあります。

## 2. API・バックエンド設計 (Node.js/Express)
*   **エラーレスポンスの統一**:
    *   エラー時に単に `res.send("Error")` と返すと、受け取る側（Frontend）の `StartLine`JSONパース`EndLine` で落ちます。
    *   成功時も失敗時も **JSON形式** (`{ success: false, error: "..." }`) で返すことで、フロントエンドのエラー処理が統一できます。
*   **SQLインジェクション対策**:
    *   SQL文に直接変数を埋め込まず（`WaitMs`... WHERE id = ${id}`EndLine`）、プレースホルダー（`WaitMs`... WHERE id = $1`EndLine`）を必ず使用してください。`pg` ライブラリはこの機能を標準で持っています。
*   **RESTfulなURL設計**:
    *   リソース（customers）に対してメソッド（GET, POST, DELETE）で操作を決める設計が直感的です。
    *   `GET /customers/:id` (取得), `DELETE /customers/:id` (削除) など。

## 3. フロントエンド実装 (HTML/JS)
*   **ファイルパスの階層**:
    *   JavaScriptの `import` は、HTMLファイルからの相対パスになります。
    *   `customer/list.html` から見る `config.js` は `../config.js` ですが、`index.html` からは `./config.js` ではありません（配置によります）。階層構造を意識したインポートが必要です。
*   **非同期処理とUX**:
    *   `fetch` は非同期なので、データ取得中に画面が真っ白にならないよう **「読み込み中(Loading...)」** の表示を出すことが重要です。
    *   同様に、ボタンの **「二重送信防止」**（処理中はボタンを無効化 `disabled`）も必須です。
*   **データ型の不一致**:
    *   PostgreSQLのカラム名は通常すべて小文字（`company_name`）です。JavaScriptではキャメルケース（`companyName`）を使いたがりますが、この変換漏れでデータが表示されないことが多発します。

## 4. データベース (PostgreSQL)
*   **制約 (Constraint) の活用**:
    *   データの整合性を保つため、重複させたくない項目（電話番号やメールなど）には `UNIQUE` 制約をつけます。
    *   エラー発生時（`duplicate key value...`）は、それをフロントエンドで検知して「すでに登録されています」とユーザーに親切に伝える必要があります。

---
**今後の推奨アクション**:
*   入力フォームのバリデーション（必須チェック、形式チェック）をフロントエンドだけでなくバックエンドにも実装する。
*   共通部品（ヘッダーやサイドバー）が増えてきたら、HTMLを分割管理できる仕組み（テンプレートエンジンなど）の導入を検討する。
